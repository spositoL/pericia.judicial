<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculadora de Financiamento Judicial | Dr. Lincoln Sposito</title>
    <meta name="description" content="Simulador online de amortização para perícia judicial. Calcule sistemas SAC, Price e SACRE.">
    
	<meta property="og:type" content="website">
	<meta property="og:url" content="https://spositol.github.io/pericia.judicial/calculo-financiamento-sistema-sac-price-sacre.html">
	<meta property="og:title" content="Calculadora Pericial de Amortização: SAC, Price e SACRE">
	<meta property="og:description" content="Simulador técnico para recálculo de financiamentos. Compare sistemas de amortização, identifique anatocismo e valide o CET Real.">
	<meta property="og:image" content="https://spositol.github.io/pericia.judicial/img/perito-judicial-simulador-financeiro.webp">

	<meta name="twitter:card" content="summary_large_image">
	<meta name="twitter:site" content="@lincolnsposito">
	<meta name="twitter:title" content="Simulador de Amortização Judicial | Dr. Lincoln Sposito">
	<meta name="twitter:description" content="Auditoria de financiamentos bancários com precisão acadêmica. Ferramenta gratuita para advogados.">
	<meta name="twitter:image" content="https://spositol.github.io/pericia.judicial/img/perito-judicial-simulador-financeiro.webp">
	
	<link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&family=Playfair+Display:wght@700&display=swap" rel="stylesheet">

<script async src="https://www.googletagmanager.com/gtag/js?id=G-5F1FGJ25TK"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-5F1FGJ25TK');
</script>	

<script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@graph": [
        {
          "@type": "WebApplication",
          "name": "Calculadora de Amortização Judicial: SAC, Price e SACRE",
          "description": "Simulador técnico para perícia judicial. Calcule e compare sistemas de amortização, identifique anatocismo e valide o Custo Efetivo Total (CET).",
          "url": "https://spositol.github.io/pericia.judicial/calculo-financiamento-sistema-sac-price-sacre.html",
          "applicationCategory": "FinanceApplication",
          "operatingSystem": "All",
          "author": {
            "@type": "Person",
            "name": "Dr. Lincoln Sposito",
            "url": "https://www.linkedin.com/in/lincolnsposito/"
          },
          "offers": {
            "@type": "Offer",
            "price": "0",
            "priceCurrency": "BRL"
          }
        },
        {
          "@type": "FAQPage",
          "mainEntity": [
            {
              "@type": "Question",
              "name": "Qual a diferença entre o sistema SAC e a Tabela Price na perícia?",
              "acceptedAnswer": {
                "@type": "Answer",
                "text": "No sistema SAC, as prestações são decrescentes e a amortização é constante. Na Tabela Price, as parcelas são fixas, mas os juros são capitalizados de forma composta, o que pode gerar anatocismo se não houver transparência algorítmica."
              }
            },
            {
              "@type": "Question",
              "name": "Como calcular o CET real de um financiamento?",
              "acceptedAnswer": {
                "@type": "Answer",
                "text": "O Custo Efetivo Total (CET) deve considerar não apenas a taxa nominal, mas todos os encargos, seguros e tarifas ocultas. Esta calculadora utiliza o método de Newton-Raphson para encontrar a taxa interna de retorno real do contrato."
              }
            }
          ]
        }
      ]
    }
</script>

</head>
<body>

    <nav class="navbar" style="background-color: #1a2a3a; padding: 15px 0; border-bottom: 2px solid #c5a059;">
        <div class="container" style="display: flex; justify-content: space-between; align-items: center; max-width: 1100px; margin: 0 auto; padding: 0 20px;">
            <div class="logo-wrapper">
                <a href="index.html" style="text-decoration: none; display: block; width: 220px;">
                    <img src="grafico.svg" width="220" height="60" alt="Logo Dr. Lincoln Sposito">
                </a>                
            </div>
            <a href="index.html" class="btn-primary">Voltar ao Início</a>
        </div>
    </nav>  

    <header class="hero-subpage" style="padding: 40px 0; background: var(--bg-light); border-bottom: 1px solid #ddd;">
        <div class="container">
            <h1>Calculadora de Amortização e Financiamento</h1>
            <p>Ferramenta técnica para análise de contratos e verificação de encargos financeiros.</p>
        </div>
    </header>

    <section class="calc-section" style="padding: 50px 0;">
        <div class="container">
            <div class="calc-grid" style="display: grid; grid-template-columns: 1fr 1fr; gap: 40px;">
                
                <div class="calc-inputs" style="background: white; padding: 30px; border-radius: 8px; box-shadow: 0 4px 15px rgba(0,0,0,0.1);">
                    <h2 style="font-size: 1.5rem; margin-bottom: 20px;">Parâmetros do Cálculo</h2>
                    
                    <div class="input-group">
                        <label>Sistema de Amortização</label>
                        <select id="sistema" class="form-control">
                            <option value="price" selected>Amortização Crescente (Price)</option>
                            <option value="sac">Amortização Constante (SAC)</option>
                            <option value="sacre">Amortização Híbrida (SACRE)</option>
                        </select>
                    </div>

                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                        <div class="input-group"><label>Valor do Bem</label><input type="text" id="valorBem" class="mask-money" value="0,00" oninput="calcularFinanciamento()"></div>
                        <div class="input-group"><label>Entrada</label><input type="text" id="valorEntrada" class="mask-money" value="0,00" oninput="calcularFinanciamento()"></div>
                    </div>

                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                        <div class="input-group"><label>Financiamento (Principal)</label><input type="text" id="valorPrincipal" class="mask-money" value="0,00" oninput="calcularTotalFinanciado()"></div>
                        <div class="input-group"><label>Total Despesas</label><input type="text" id="despesas" class="mask-money" value="0,00" oninput="calcularTotalFinanciado()"></div>
                    </div>

                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                        <div class="input-group"><label>Total (Principal + Desp)</label><input type="text" id="valorTotal" class="mask-money" value="0,00" style="background: #f0f4f8; font-weight: bold;"></div>
                        <div class="input-group">
							<label id="labelParcela">Valor da Parcela (Informado)</label>
							<input type="text" id="valorParcelaInformado" class="mask-money" placeholder="Ex: 9333,33">
						</div>
                    </div>

                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                        <div class="input-group"><label>Taxa Nominal (% a.m.)</label><input type="text" id="taxaNominal" class="mask-percent" value="2,0000000000"></div>
                        <div class="input-group"><label>Taxa Efetiva (% a.m.)</label><input type="text" id="taxaEfetiva" class="mask-percent" value="2,0000000000"></div>
                    </div>

                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                        <div class="input-group"><label>Nº de Parcelas</label><input type="number" id="parcelas" value="1" min="1"></div>
                        <div class="input-group"><label>Carência (Dias)</label><input type="text" id="carencia" readonly style="background: #f8f9fa;"></div>
                    </div>

                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                        <div class="input-group"><label>Data Contrato</label><input type="date" id="dataCelebracao" onchange="calcularCarencia()"></div>
                        <div class="input-group"><label>1º Vencimento</label><input type="date" id="dataVencimento" onchange="calcularCarencia()"></div>
                    </div>
					
					<div class="input-group" style="margin-top: 20px; background: #fff9e6; padding: 15px; border-radius: 8px; border: 1px solid #c5a059;">
						<label style="color: #1a2a3a; font-weight: bold;">Tipo de Simulação:</label>
						<div style="display: flex; gap: 20px; margin-top: 10px;">
							<label style="font-weight: normal; cursor: pointer;">
								<input type="radio" name="tipoVisao" value="banco" checked> Plano do Banco (Dados Informados)
							</label>
							<label style="font-weight: normal; cursor: pointer;">
								<input type="radio" name="tipoVisao" value="revisado"> Plano Revisado (Cálculo Pericial)
							</label>
						</div>
					</div>					

                    <button onclick="processarCalculo()" class="btn-primary" style="width: 100%; margin-top: 20px; padding: 15px;">Gerar Tabela e Insights</button>
                </div>

                <div class="calc-sidebar">
                    <div class="info-box">
                        <h3>Como funciona?</h3>
                        <p>Esta ferramenta identifica divergências entre o contratado e o aplicado matematicamente.</p>
                        <ul style="padding-left: 20px; font-size: 0.9rem;">
                            <li><a href="#artigo-price">O que considerar no Sistema Price?</a></li>
                            <li><a href="#artigo-sac">Vantagens da Amortização SAC</a></li>
                            <li><a href="#artigo-sacre">Entenda a Amortização Híbrida</a></li>
                        </ul>
                    </div>
                    <div id="chatbase-integration" style="border: 1px solid #ddd; padding: 20px; border-radius: 8px; margin-top: 20px;">
                        <p style="font-size: 0.8rem; color: #666;">Dúvidas técnicas? Pergunte ao nosso assistente.</p>
                    </div>
                </div>
            </div>

            <div id="resultado-area" style="margin-top: 50px; display: none; background: #fff; padding: 30px; border: 1px solid #ddd; border-radius: 8px;">
                <div id="cabecalho-laudo" style="text-align: center; margin-bottom: 30px;">
                    <img src="grafico.svg" alt="Dr. Lincoln Sposito" style="width: 250px; height: auto;">
                    <h2 style="color: #1a2a3a; margin-top: 15px;">Análise Técnica de Amortização</h2>
                    <p style="color: #666;">Perícia Judicial e Assistência Técnica</p>
                </div>
                
                <div id="insights-cards" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 30px;"></div>
                
                <div id="resumo-financeiro"></div>
                
                <div class="table-container" style="overflow-x: auto;">
                    <table id="tabela-amortizacao" class="table-pericia" style="width: 100%; border-collapse: collapse;"></table>
                </div>
                
                <div id="cta-final"></div>
            </div>
        </div>
    </section>

    <style>
        .input-group { margin-bottom: 15px; }
        .input-group label { display: block; font-weight: 600; font-size: 0.85rem; margin-bottom: 5px; color: var(--primary); }
        .form-control, input, select { width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 4px; }
        .info-box { background: #eef2f7; padding: 20px; border-radius: 8px; border-left: 5px solid var(--accent); }
        .table-pericia th { background: #1a2a3a; color: white; padding: 12px; text-align: left; border: 1px solid #ddd; }
        .table-pericia td { padding: 10px; border: 1px solid #ddd; font-size: 0.9rem; text-align: right; }
    </style>

	<!-- ESTE SCRIPT FUNCIONAVA ANTES DA IMPLEMENTAÇÃO DA VALIDAÇÃO DO CET-->
	<script>
			// --- 1. FUNÇÕES DE INTERFACE E MÁSCARAS ---
			window.onload = function() {
				const hoje = new Date();
				const vencimento = new Date();
				vencimento.setDate(hoje.getDate() + 30);
				document.getElementById('dataCelebracao').value = hoje.toISOString().split('T')[0];
				document.getElementById('dataVencimento').value = vencimento.toISOString().split('T')[0];
				calcularCarencia();
			};

			function parseMoeda(v) { return parseFloat(v.replace(/\./g, '').replace(',', '.')) || 0; }
			function parsePercentual(v) { 
				if(!v) return 0;
				let limpo = v.replace('%', '').trim().replace(/\./g, '').replace(',', '.');
				return parseFloat(limpo) || 0; 
			}
			function formatarMoeda(v) { return v.toLocaleString('pt-BR', { minimumFractionDigits: 2, maximumFractionDigits: 2 }); }

			function calcularFinanciamento() {
				const principal = Math.max(0, parseMoeda(document.getElementById('valorBem').value) - parseMoeda(document.getElementById('valorEntrada').value));
				document.getElementById('valorPrincipal').value = formatarMoeda(principal);
				calcularTotalFinanciado();
			}

			function calcularTotalFinanciado() {
				const total = parseMoeda(document.getElementById('valorPrincipal').value) + parseMoeda(document.getElementById('despesas').value);
				document.getElementById('valorTotal').value = formatarMoeda(total);
			}

			function calcularCarencia() {
				const d1 = new Date(document.getElementById('dataCelebracao').value);
				const d2 = new Date(document.getElementById('dataVencimento').value);
				if (d1 && d2) document.getElementById('carencia').value = Math.ceil(Math.abs(d2 - d1) / (1000 * 60 * 60 * 24));
			}

			document.querySelectorAll('.mask-money').forEach(i => i.addEventListener('blur', function() { this.value = formatarMoeda(parseMoeda(this.value)); }));
			document.querySelectorAll('.mask-percent').forEach(i => i.addEventListener('blur', function() { 
				let v = parsePercentual(this.value);
				this.value = v.toLocaleString('pt-BR', { minimumFractionDigits: 2, maximumFractionDigits: 10 }) + '%'; 
			}));
			
			document.getElementById('sistema').addEventListener('change', function() {
				const label = document.getElementById('labelParcela');
				const avisoArea = document.getElementById('chatbase-integration');
				if (this.value === 'price') {
					label.innerHTML = 'Valor da Parcela Fixa (Contrato)';
					if(avisoArea) avisoArea.innerHTML = '<p style="font-size: 0.8rem; color: #666;">Sistema Price: Prestações constantes.</p>';
				} else if (this.value === 'sac') {
					label.innerHTML = 'Valor da <strong>1ª Parcela</strong> (Contrato)';
					if(avisoArea) avisoArea.innerHTML = '<p style="font-size: 0.8rem; color: #666;">Sistema SAC: Amortização constante.</p>';
				} else if (this.value === 'sacre') {
					label.innerHTML = 'Valor da <strong>1ª Parcela</strong> (Contrato)';
					if(avisoArea) avisoArea.innerHTML = '<div style="background:#e7f3ff; color:#0056b3; padding:10px; border-radius:5px; font-size:0.8rem;"><strong>Nota BACEN:</strong> O SACRE utiliza projeção de inflação fixa em 4% a.a. para fins de auditoria pericial.</div>';
				}
			});

			// --- 2. MOTOR DE CÁLCULO (DISPATCHER) ---
			function processarCalculo() {
				try {
					const sistema = document.getElementById('sistema').value;
					const visao = document.querySelector('input[name="tipoVisao"]:checked').value;
					const p = {
						n: parseInt(document.getElementById('parcelas').value),
						iNom: parsePercentual(document.getElementById('taxaNominal').value) / 100,
						pvPrin: parseMoeda(document.getElementById('valorPrincipal').value),
						desp: parseMoeda(document.getElementById('despesas').value),
						pmtInfo: parseMoeda(document.getElementById('valorParcelaInformado').value)
					};
					p.pvTotal = p.pvPrin + p.desp;
					
					if (p.pvTotal <= 0 || p.n <= 0 || p.iNom <= 0) { alert("Dados incompletos."); return; }

					const cetCalculado = calcularCET_Real(p, sistema.toUpperCase());
					const cetInformado = parsePercentual(document.getElementById('taxaEfetiva').value) / 100;

					let auditoriaBanco, planoRevisado;

					if (sistema === 'price') {
						auditoriaBanco = motorPrice(p, 'banco');
						planoRevisado = motorPrice(p, 'revisado');
						renderizarLaudoUnificado(auditoriaBanco, planoRevisado, p, visao, "PRICE", cetCalculado, cetInformado);
					} 
					else if (sistema === 'sac') {
						auditoriaBanco = motorSAC(p, 'banco');
						planoRevisado = motorSAC(p, 'revisado');
						renderizarLaudoUnificado(auditoriaBanco, planoRevisado, p, visao, "SAC", cetCalculado, cetInformado);
					} 
					else if (sistema === 'sacre') {
						auditoriaBanco = motorSACRE(p, 'banco');
						planoRevisado = motorSACRE(p, 'revisado');
						renderizarLaudoUnificado(auditoriaBanco, planoRevisado, p, visao, "SACRE", cetCalculado, cetInformado);
					}

				} catch (e) { console.error(e); }
			}

			// --- 3. ENCAPSULAMENTO PRICE ---
			function motorPrice(p, tipo) {
				let pmtCorreta = p.pvTotal * ( (p.iNom * Math.pow(1 + p.iNom, p.n)) / (Math.pow(1 + p.iNom, p.n) - 1) );
				let pmtUso = (tipo === 'banco' && p.pmtInfo > 0) ? p.pmtInfo : pmtCorreta;
				let saldo = p.pvTotal, tPmt = 0, tJur = 0, tAmort = 0, tabela = [];

				for (let i = 1; i <= p.n; i++) {
					let jur = saldo * p.iNom;
					let amort = pmtUso - jur;
					saldo -= amort;
					tPmt += pmtUso; tJur += jur; tAmort += amort;
					tabela.push({ n: i, pmt: pmtUso, jur: jur, amort: amort, saldo: saldo });
				}
				return { tabela, pmtRef: pmtCorreta, tPmt, tJur, tAmort, saldoFinal: saldo };
			}

			// --- 4. ENCAPSULAMENTO SAC ---
			function motorSAC(p, tipo) {
				const amortConstante = p.pvTotal / p.n;
				const pmtPrimeiraCorreta = amortConstante + (p.pvTotal * p.iNom);
				const decrescimoMensal = amortConstante * p.iNom;
				let pmtBase = (tipo === 'banco' && p.pmtInfo > 0) ? p.pmtInfo : pmtPrimeiraCorreta;
				let saldo = p.pvTotal, tPmt = 0, tJur = 0, tAmort = 0, tabela = [];

				for (let i = 1; i <= p.n; i++) {
					let jur = saldo * p.iNom;
					let pmtNoMes = pmtBase - (decrescimoMensal * (i - 1));
					let amort = pmtNoMes - jur;
					saldo -= amort;
					tPmt += pmtNoMes; tJur += jur; tAmort += amort;
					tabela.push({ n: i, pmt: pmtNoMes, jur: jur, amort: amort, saldo: saldo });
				}
				return { tabela, pmtRef: pmtPrimeiraCorreta, tPmt, tJur, tAmort, saldoFinal: saldo };
			}

			// --- 5. ENCAPSULAMENTO SACRE (AUDITORIA PERICIAL) ---
			// --- 5. ENCAPSULAMENTO SACRE (ALINHADO COM EXCEL PERICIAL) ---
			function motorSACRE(p, tipo) {
				// Fator exato do Excel para evitar desvios: 1,00327374
				const inflacaoMensal = 0.00327374; 
				let saldo = p.pvTotal;
				let tPmt = 0, tJur = 0, tAmort = 0, tabela = [];

				// Cálculo da 1ª Parcela Técnica (Referência)
				let primeiroSaldoCM = p.pvTotal * (1 + inflacaoMensal);
				let pmtTecnica = (primeiroSaldoCM / p.n) + (primeiroSaldoCM * p.iNom);

				for (let i = 1; i <= p.n; i++) {
					let prazoRemanescente = p.n - i + 1;
					let saldoCorrigido = saldo * (1 + inflacaoMensal);
					let jur = saldoCorrigido * p.iNom;
					
					let pmtAtual;
					if (tipo === 'banco' && i === 1 && p.pmtInfo > 0) {
						// No modo BANCO, respeitamos a entrada do usuário para testar a taxa
						pmtAtual = p.pmtInfo;
					} else {
						// No REVISADO ou a partir da 2ª do banco, segue o SACRE Estrito
						pmtAtual = (saldoCorrigido / prazoRemanescente) + jur;
					}

					let amort = pmtAtual - jur;
					saldo = saldoCorrigido - amort;

					tPmt += pmtAtual; tJur += jur; tAmort += amort;

					tabela.push({
						n: i,
						saldoCorrigido: saldoCorrigido,
						pmt: pmtAtual,
						jur: jur,
						amort: amort,
						saldo: Math.abs(saldo) < 0.01 ? 0 : saldo 
					});
				}

				return { 
					tabela, 
					pmtRef: pmtTecnica, 
					tPmt, 
					tJur, 
					tAmort, 
					saldoFinal: Math.abs(saldo) < 0.05 ? 0 : saldo 
				};
			}

			// --- 6. RENDERIZAÇÃO UNIFICADA (COM ATALHO PERICIAL E BYPASS SACRE) ---
			//function renderizarLaudoUnificado(banco, revisado, p, visao, nomeSistema) {
			function renderizarLaudoUnificado(banco, revisado, p, visao, nomeSistema, cetCalc, cetInfo) {
				const area = document.getElementById('resultado-area');
				area.style.display = 'block';
				
				// 1. CÁLCULOS DE AUDITORIA
				const saldoF_Abs = Math.abs(banco.saldoFinal);
				const taxaReal = calcularTaxaImplicita(p.pvTotal, p.pmtInfo, p.n, nomeSistema);
				const difCET = Math.abs(cetCalc - cetInfo);
				
				// 2. LÓGICA DE VALIDAÇÃO (ATALHO PERICIAL)
				let taxaDivergente;
				if (nomeSistema === "SACRE") {
					const diferencaParcela = Math.abs(p.pmtInfo - banco.pmtRef);
					taxaDivergente = diferencaParcela > 0.01; 
				} else {
					const diferencaTaxa = Math.abs(taxaReal - p.iNom);
					taxaDivergente = diferencaTaxa > 0.00001;
				}

				// 3. HIERARQUIA DE VEREDITOS E CORES
				let status, cor, msg;
				let labelResiduo = (nomeSistema === "SACRE") ? "SALDO RESIDUAL INFLACIONÁRIO" : "RESÍDUO EM ABERTO";

				if (cetInfo > 0 && difCET > 0.0001) {
					status = "INCONSISTÊNCIA DE CUSTO (CET)";
					cor = "#d9534f"; 
					msg = `Divergência Documental: O contrato declara CET de ${(cetInfo*100).toFixed(6)}%, mas o custo real apurado é de ${(cetCalc*100).toFixed(6)}%.`;
				} else if (taxaDivergente) {
					status = "PLANO INCORRETO / INCONSISTÊNCIA";
					cor = "#d9534f"; 
					msg = nomeSistema === "SACRE" 
						? `A 1ª parcela de R$ ${formatarMoeda(p.pmtInfo)} diverge do cálculo técnico para a taxa de ${(p.iNom*100).toFixed(4)}%.`
						: `A taxa nominal de ${(p.iNom*100).toFixed(4)}% não condiz matematicamente com a parcela de R$ ${formatarMoeda(p.pmtInfo)}.`;
				} else if (nomeSistema === "SACRE" && saldoF_Abs > 0.10) {
					status = "DIVERGÊNCIA DE RECOMPOSIÇÃO";
					cor = "#31708f"; 
					msg = "O plano apresenta saldo residual decorrente da meta de inflação projetada (4% a.a.).";
				} else if (saldoF_Abs > 0.10) {
					status = "PLANO INCORRETO";
					cor = "#d9534f";
					msg = "O fluxo de pagamentos informado é insuficiente para liquidar o saldo devedor no prazo contratado.";
				} else if (saldoF_Abs >= 0.05) {
					status = "PLANO ACEITÁVEL";
					cor = "#ffc107"; 
					msg = "O plano do banco possui oscilação mínima aceitável decorrente de arredondamentos.";
				} else {
					status = "PLANO VALIDADO";
					cor = "#28a745"; 
					msg = "O plano do banco apresenta conformidade técnica.";
				}

				const dadosExibir = (visao === 'banco') ? banco : revisado;
				const tituloVisao = (visao === 'banco') ? "Plano do Banco (Auditado)" : "Plano Revisado (Correto)";

				let tableHeader = `<th>Nº</th><th>Parcela</th><th>Juros</th><th>Amortização</th><th>Saldo</th>`;
				if (nomeSistema === "SACRE") {
					tableHeader = `<th>Nº</th><th>Saldo Corrigido (CM)</th><th>Parcela</th><th>Juros</th><th>Amortização</th><th>Saldo Final</th>`;
				}

				area.innerHTML = `
					<div id="laudo-container" style="border: 1px solid #ddd; border-radius: 8px; background: #fff; overflow:hidden;">
						<div style="background-color: #1a2a3a; padding: 30px; border-bottom: 4px solid #c5a059; text-align: center; color: white;">
							<img src="https://spositol.github.io/pericia.judicial/grafico.svg" alt="Dr. Lincoln Sposito" style="width: 250px;">
							<h2 style="font-family: 'Playfair Display', serif; margin-top:10px;">Laudo Pericial: Sistema ${nomeSistema}</h2>
						</div>
						
						<div style="padding: 30px;">
							<div class="info-box" style="border-left: 8px solid ${cor}; background: #fdfdfd; padding: 25px; margin-bottom: 30px; box-shadow: 0 4px 6px rgba(0,0,0,0.05);">
								<h4 style="color: ${cor}; text-transform: uppercase; margin-top:0; font-weight:800;">${status}</h4>
								<p style="color: #333; font-size: 1.05rem;">${msg}</p>
								
								<div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; margin: 20px 0; border-top: 1px solid #eee; border-bottom: 1px solid #eee; padding: 15px 0;">
									<div><small>TOTAL PAGO (BANCO)</small><br><strong>R$ ${formatarMoeda(banco.tPmt)}</strong></div>
									<div><small>JUROS ACUMULADOS</small><br><strong>R$ ${formatarMoeda(banco.tJur)}</strong></div>
									<div><small>AMORTIZAÇÃO REAL</small><br><strong>R$ ${formatarMoeda(banco.tAmort)}</strong></div>
								</div>

								<p style="font-size: 0.95rem; line-height: 1.6; background: #f8f9fa; padding: 15px; border-radius: 4px; border: 1px solid #eee;">
									<strong>Parâmetros de Auditoria:</strong><br>
									<hr style="border:0; border-top: 1px solid #e0e0e0; margin: 8px 0;">
									• Parcela Informada (Banco): <strong>R$ ${formatarMoeda(p.pmtInfo)}</strong><br>
									• Parcela Revisada (Técnica): <strong>R$ ${formatarMoeda(banco.pmtRef)}</strong><br>
									<hr style="border:0; border-top: 1px solid #e0e0e0; margin: 8px 0;">
									• Taxa Nominal Contratada: <strong>${(p.iNom*100).toFixed(6)}%</strong><br>
									• Taxa Revisada (em função da parcela): <strong style="color:#d9534f;">${(taxaReal*100).toFixed(6)}%</strong><br>
									<hr style="border:0; border-top: 1px solid #e0e0e0; margin: 8px 0;">
									• CET Declarado: ${(cetInfo*100).toFixed(6)}%<br>
									• CET Pericial (em função do capital líquido): <strong>${(cetCalc*100).toFixed(6)}%</strong>
								</p>

								<p style="font-size: 1.1rem; margin-top: 15px; color: ${cor}; font-weight: bold;">
									${banco.saldoFinal < -0.01 ? `PAGAMENTO INDÉBITO DETECTADO: R$ ${formatarMoeda(Math.abs(banco.saldoFinal))}` : `${labelResiduo}: R$ ${formatarMoeda(banco.saldoFinal)}`}
								</p>
							</div>

							<h3 style="color: #1a2a3a; border-bottom: 2px solid #eee; padding-bottom: 10px; margin-bottom: 20px;">Exibindo: ${tituloVisao}</h3>
							<div class="table-container" style="overflow-x: auto;">
								<table class="table-pericia" style="width:100%; border-collapse: collapse;">
									<thead><tr>${tableHeader}</tr></thead>
									<tbody>
										${dadosExibir.tabela.map(it => {
											if (nomeSistema === "SACRE") {
												return `<tr>
													<td>${it.n}</td>
													<td style="background:#f0f7ff;">R$ ${formatarMoeda(it.saldoCorrigido)}</td>
													<td>R$ ${formatarMoeda(it.pmt)}</td>
													<td>R$ ${formatarMoeda(it.jur)}</td>
													<td>R$ ${formatarMoeda(it.amort)}</td>
													<td>R$ ${formatarMoeda(it.saldo)}</td>
												</tr>`;
											} else {
												return `<tr>
													<td>${it.n}</td>
													<td>R$ ${formatarMoeda(it.pmt)}</td>
													<td>R$ ${formatarMoeda(it.jur)}</td>
													<td>R$ ${formatarMoeda(it.amort)}</td>
													<td ${it.n === p.n && saldoF_Abs > 0.1 ? 'style="color:red; font-weight:bold;"' : ''}>R$ ${formatarMoeda(it.saldo)}</td>
												</tr>`;
											}
										}).join('')}
										<tr style="background:#f8f9fa; font-weight:bold;">
											<td>TOTAIS</td>
											${nomeSistema === "SACRE" ? "<td>---</td>" : ""}
											<td>R$ ${formatarMoeda(dadosExibir.tPmt)}</td>
											<td>R$ ${formatarMoeda(dadosExibir.tJur)}</td>
											<td>R$ ${formatarMoeda(dadosExibir.tAmort)}</td>
											<td>---</td>
										</tr>
									</tbody>
								</table>
							</div>
							<div id="cta-pericial" style="margin-top: 40px; padding: 30px; background: #fdf8ef; border: 2px dashed #c5a059; border-radius: 8px; text-align: center;">
								<h3 style="font-family: 'Playfair Display', serif; color: #1a2a3a; margin-bottom: 15px;">Deseja uma análise jurídica detalhada deste contrato?</h3>
								<p style="color: #666; margin-bottom: 25px;">Nossa equipe de especialistas em direito bancário pode ajudar você a recuperar valores pagos indevidamente.</p>
								<a href="https://wa.me/11914612603" target="_blank" class="btn-primary" style="padding: 15px 30px; text-decoration: none; font-weight: bold; border-radius:5px; display: inline-block;">Falar com Dr Lincoln agora</a>
							</div>                        
						</div>
					</div>`;
				area.scrollIntoView({ behavior: 'smooth' });
			}

			function calcularTaxaImplicita(pv, pmt, n, sistema) {
				if (sistema !== 'PRICE') {
					const amort = pv / n;
					return (pmt - amort) / pv;
				}
				let i = 0.01;
				for (let x = 0; x < 30; x++) {
					let f = pmt * (1 - Math.pow(1 + i, -n)) / i - pv;
					let df = pmt * (n * Math.pow(1 + i, -n - 1) * i - (1 - Math.pow(1 + i, -n))) / (i * i);
					i = i - f / (df || 1);
				}
				return i;
			}

			function calcularCET_Real(p, sistema) {
				const pvLiquido = p.pvPrin;
				const n = p.n;
				const iNom = p.iNom;
				const pvTotal = p.pvTotal;

				// Se for PRICE, usamos a fórmula de Newton-Raphson para parcelas fixas
				if (sistema === 'PRICE') {
					let i = 0.01;
					const pmt = p.pmtInfo;
					for (let x = 0; x < 40; x++) {
						let pot = Math.pow(1 + i, -n);
						let f = pmt * (1 - pot) / i - pvLiquido;
						let df = pmt * ((n * pot) / (i * (1 + i)) - (1 - pot) / (i * i));
						i = i - f / (df || 1);
					}
					return i;
				}

				// Se for SAC ou SACRE, iteramos sobre o fluxo decrescente real
				let iCET = 0.01; 
				const amortizacao = pvTotal / n;

				for (let x = 0; x < 60; x++) {
					let f = -pvLiquido;
					let df = 0;

					for (let t = 1; t <= n; t++) {
						// Reconstrói a parcela t do SAC/SACRE para confrontar com o valor líquido
						let saldoDevedorAnterior = pvTotal - (amortizacao * (t - 1));
						let pmt_t = amortizacao + (saldoDevedorAnterior * iNom);
						
						let pot = Math.pow(1 + iCET, -t);
						f += pmt_t * pot;
						df -= t * pmt_t * Math.pow(1 + iCET, -t - 1);
					}

					iCET = iCET - f / (df || 1);
					if (Math.abs(f) < 0.0000001) break; 
				}
				return iCET;
			}
	</script> 

</body>
</html>
